This code was not originally written by @techno11, but has been modified